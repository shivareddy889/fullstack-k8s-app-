# --------------------------------------------
# ğŸ§± Base image (lightweight Node.js on Alpine)
# --------------------------------------------
FROM node:18-alpine

# --------------------------------------------
# ğŸ“‚ Set working directory inside the container
# --------------------------------------------
WORKDIR /app

# --------------------------------------------
# ğŸ“¦ Copy dependency files first (to leverage caching)
# --------------------------------------------
COPY package*.json ./

# --------------------------------------------
# âš™ï¸ Install only production dependencies
# --------------------------------------------
RUN npm install --only=production


# --------------------------------------------
# ğŸ“„ Copy the remaining application source code
# --------------------------------------------
COPY . .

# --------------------------------------------
# ğŸ‘¤ Create and use a non-root user for security
# --------------------------------------------
RUN addgroup -S appgroup && adduser -S appuser -G appgroup
RUN chown -R appuser:appgroup /app
USER appuser

# --------------------------------------------
# ğŸŒ Expose the application port
# --------------------------------------------
EXPOSE 3000

# --------------------------------------------
# ğŸš€ Start the Node.js application
# --------------------------------------------
CMD ["node", "server.js"]
